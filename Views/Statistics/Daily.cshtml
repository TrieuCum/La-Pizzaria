@{
    ViewData["Title"] = "Th·ªëng k√™ theo ng√†y";
    var day = (DateTime)ViewBag.Day;
}

<div class="d-flex align-items-center justify-content-between mb-4">
    <h3 class="mb-0 fw-bold">üìä Th·ªëng k√™ theo ng√†y</h3>
    <div class="d-flex align-items-center gap-2">
        <a class="btn btn-sm btn-dark" asp-action="Daily">Th·ªëng k√™ theo ng√†y</a>
        <a class="btn btn-sm btn-outline-dark" asp-action="Weekly">Th·ªëng k√™ theo tu·∫ßn</a>
    </div>
</div>

<div class="card shadow-sm border-0 mb-4">
    <div class="card-body">
        <div class="row g-3 align-items-end">
            <div class="col-md-auto">
                <label class="form-label fw-semibold mb-1">üìÖ Ch·ªçn ng√†y</label>
                <input id="dayInput" type="date" class="form-control form-control-lg" value="@day.ToString("yyyy-MM-dd")" />
            </div>
            <div class="col-md-auto">
                <button id="btnLoad" class="btn btn-primary btn-lg px-4">üîÑ T·∫£i d·ªØ li·ªáu</button>
            </div>
            <div class="col-md-auto">
                <a class="btn btn-outline-secondary btn-lg" asp-action="Weekly">üìà Xem theo tu·∫ßn</a>
            </div>
        </div>
    </div>
</div>

<div class="row g-4 mb-4">
    <div class="col-12">
        <div class="card shadow-sm border-0">
            <div class="card-body">
                <div class="d-flex flex-wrap gap-3 mb-3 align-items-center">
                    <span class="badge bg-primary bg-gradient px-3 py-2 fs-6" id="badgeDate">-</span>
                    <span class="badge bg-success bg-gradient px-3 py-2 fs-6" id="badgeRevenue">0ƒë</span>
                </div>
                <div id="result" class="alert alert-info border-0 shadow-sm mb-0"></div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4">
    <div class="col-12">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-white border-bottom">
                <h5 class="mb-0 fw-semibold">üìä Bi·ªÉu ƒë·ªì doanh thu</h5>
            </div>
            <div class="card-body">
                <canvas id="dayChart" height="120"></canvas>
            </div>
        </div>
    </div>
    <div class="col-12">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-white border-bottom">
                <h5 class="mb-0 fw-semibold">üìã Chi ti·∫øt th·ªëng k√™</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0" id="detailTable">
                        <thead class="table-light">
                            <tr>
                                <th class="fw-semibold">Ch·ªâ s·ªë</th>
                                <th class="fw-semibold">Gi√° tr·ªã</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
async function loadDay() {
    const day = document.getElementById('dayInput').value;
    const url = `/Statistics/DailyData?day=${encodeURIComponent(day)}`;
    const res = await fetch(url);
    const data = await res.json();
    const d = new Date(data.date);
    const text = `Doanh thu ng√†y ${d.toLocaleDateString()}: ${Number(data.revenue).toLocaleString()}ƒë`;
    document.getElementById('result').innerText = text;
    document.getElementById('badgeDate').innerText = d.toLocaleDateString();
    document.getElementById('badgeRevenue').innerText = Number(data.revenue).toLocaleString() + 'ƒë';

    // vertical details table
    const tbody = document.querySelector('#detailTable tbody');
    tbody.innerHTML = '';
    const rows = [
        { k: 'Ng√†y', v: d.toLocaleDateString() },
        { k: 'T·ªïng doanh thu', v: Number(data.revenue).toLocaleString() + 'ƒë' }
    ];
    rows.forEach(r => {
        const tr = document.createElement('tr');
        const td1 = document.createElement('td'); td1.textContent = r.k;
        const td2 = document.createElement('td'); td2.textContent = r.v;
        tr.appendChild(td1); tr.appendChild(td2);
        tbody.appendChild(tr);
    });

    // Simple single-bar chart
    const ctx = document.getElementById('dayChart');
    if (window.__dayChart) { window.__dayChart.destroy(); }
    window.__dayChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: [d.toLocaleDateString()],
            datasets: [{ 
                label: 'Doanh thu', 
                data: [data.revenue], 
                backgroundColor: 'rgba(76, 175, 80, 0.8)',
                borderColor: 'rgba(76, 175, 80, 1)',
                borderWidth: 2,
                borderRadius: 8,
                borderSkipped: false
            }]
        },
        options: { 
            responsive: true, 
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: {
                        font: { size: 14, weight: '600' },
                        padding: 15
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    padding: 12,
                    titleFont: { size: 14, weight: '600' },
                    bodyFont: { size: 13 },
                    callbacks: {
                        label: function(context) {
                            return 'Doanh thu: ' + Number(context.parsed.y).toLocaleString() + 'ƒë';
                        }
                    }
                }
            },
            scales: { 
                y: { 
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return value.toLocaleString() + 'ƒë';
                        },
                        font: { size: 12 }
                    },
                    grid: {
                        color: 'rgba(0, 0, 0, 0.05)'
                    }
                },
                x: {
                    grid: {
                        display: false
                    },
                    ticks: {
                        font: { size: 12 }
                    }
                }
            } 
        }
    });
}
document.getElementById('btnLoad').addEventListener('click', loadDay);
loadDay();
</script>


