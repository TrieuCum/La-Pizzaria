@model IEnumerable<LaPizzaria.Models.Table>

<h2>Bàn ăn</h2>

<div class="card p-3 mb-3">
    <form asp-controller="Order" asp-action="MergeTables" method="post" id="mergeForm" class="row g-2 align-items-end">
        <div class="col-md-4">
            <label class="form-label">Order đang mở</label>
            <select name="orderId" class="form-select" required>
                <option value="" selected disabled>Chọn Order</option>
                @foreach (var o in (IEnumerable<LaPizzaria.Models.Order>)ViewBag.OpenOrders)
                {
                    <option value="@o.Id">#@o.Id - @o.OrderDate.ToLocalTime().ToString("dd/MM HH:mm")</option>
                }
            </select>
        </div>
        <div class="col-md-8 d-flex gap-2">
            <button type="submit" class="btn btn-success">Gộp bàn đã chọn</button>
            <a asp-action="Upsert" class="btn btn-primary">Thêm bàn</a>
            <a asp-controller="Order" asp-action="Qr" class="btn btn-outline-secondary">Tạo QR</a>
        </div>
        <div class="col-12"><small class="text-muted">Chọn nhiều bàn bằng checkbox, sau đó bấm Gộp.</small></div>
    </form>
</div>

<div class="row g-3">
    @foreach (var t in Model)
    {
        var attach = ((System.Collections.Generic.Dictionary<int, string>)ViewBag.TableAttachInfo).TryGetValue(t.Id, out var info) ? info : "";
        <div class="col-sm-6 col-md-4 col-lg-3">
            <div class="card shadow-sm h-100">
                <div class="card-body d-flex flex-column">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="fw-bold">@t.Code</div>
                            <div class="text-muted small">Sức chứa: @t.Capacity</div>
                        </div>
                        <input class="form-check-input mt-1" type="checkbox" name="tableIds" value="@t.Id" form="mergeForm" title="Chọn để gộp" />
                    </div>
                    <div class="mt-2">
                        <span class="badge @(@t.IsActive?"bg-success":"bg-secondary")">@(@t.IsActive?"Hoạt động":"Khóa")</span>
                        <span class="badge @(@t.IsOccupied?"bg-danger":"bg-info")">@(@t.IsOccupied?"Có khách":"Trống")</span>
                    </div>
                    <div class="mt-2 small text-muted flex-grow-1" style="min-height:2.5em">@attach</div>
                    <div class="d-flex gap-2 mt-2">
                        <form asp-action="Clear" method="post" class="d-inline">
                            <input type="hidden" name="id" value="@t.Id" />
                            <button type="submit" class="btn btn-sm btn-outline-secondary w-100">Dọn bàn</button>
                        </form>
                        <a asp-action="Upsert" asp-route-id="@t.Id" class="btn btn-sm btn-warning w-100">Sửa</a>
                        <a asp-action="Delete" asp-route-id="@t.Id" class="btn btn-sm btn-danger w-100">Xóa</a>
                    </div>
                </div>
            </div>
        </div>
    }
</div>


